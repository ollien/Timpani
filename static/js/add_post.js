function canLoadInsignia(){return null==window.navigator?!1:navigator.userAgent.indexOf("MSIE")>-1&&-1===navigator.userAgent.indexOf("MSIE 11")&&-1===navigator.userAgent.indexOf("Opera")?!1:!0}document.addEventListener("DOMContentLoaded",function(e){var t=document.getElementById("editor"),n=new Quill(t),i=ace.edit("code-editor"),l=document.getElementById("post-body"),d=document.getElementById("post-validity"),o=document.getElementById("tags-input"),a=document.getElementById("placeholder-tags-input"),s=canLoadInsignia()?insignia(o):null,u=document.getElementById("post-form"),r=document.getElementById("add-link"),c=document.getElementById("add-image"),m=document.getElementById("add-quote"),v=document.getElementById("add-code"),g=document.getElementById("align-left"),p=document.getElementById("align-center"),f=document.getElementById("align-right"),E=document.getElementById("align-justify"),L={element:document.getElementById("link-modal"),input:document.getElementById("modal-link"),init:function(){return this.modal=new Modal(this.element),this.errorDiv=this.element.querySelector("div.modal-error"),this.positiveButton=this.element.querySelector("button.positive"),delete this.init,this}}.init(),I={element:document.getElementById("image-modal"),linkInput:document.getElementById("image-url"),fileInput:document.getElementById("image-upload"),uploadRequest:null,init:function(){return this.modal=new Modal(this.element),this.positiveButton=this.element.querySelector("button.positive"),this.errorDiv=this.element.querySelector("div.modal-error"),delete this.init,this}}.init(),h={element:document.getElementById("code-modal"),selectLanguage:document.getElementById("select-language"),init:function(){return this.modal=new Modal(this.element,{keyboard:!1}),this.positiveButton=this.element.querySelector("button.positive"),delete this.init,this}}.init();d.setCustomValidity("Please fill out a post body."),n.addModule("toolbar",{container:"div#toolbar"}),n.addFormat("quote",{"class":"quote"}),n.addFormat("code",{"class":"language-"}),i.getSession().setUseWorker(!1),n.on("selection-change",function(e){null==e?(t.classList.remove("focused"),m.disabled=!0,v.disabled=!1):(t.classList.add("focused"),e.end-e.start>0?(m.disabled=!1,v.disabled=!0):(m.disabled=!0,v.disabled=!1))}),n.on("text-change",function(){var e=n.getSelection();null==e||e.end-e.start===0?(m.disabled=!0,v.disabled=!1):(m.disabled=!1,v.disabled=!0),0===n.getText().trim().length?d.setCustomValidity("Please fill out a post body."):d.setCustomValidity("")}),r.addEventListener("click",function(e){L.modal.show(),L.input.focus()}),c.addEventListener("click",function(e){I.modal.show()}),v.addEventListener("click",function(e){h.modal.show()}),g.addEventListener("click",function(e){n.focus();var t=n.getSelection();null!=t&&n.formatLine(t.start,t.end,"align","left")}),p.addEventListener("click",function(e){n.focus();var t=n.getSelection();null!=t&&n.formatLine(t.start,t.end,"align","center")}),f.addEventListener("click",function(e){n.focus();var t=n.getSelection();null!=t&&n.formatLine(t.start,t.end,"align","right")}),E.addEventListener("click",function(e){n.focus();var t=n.getSelection();null!=t&&n.formatText(t.start,t.end+1,"align","justify")}),L.element.addEventListener("show",function(e){L.input.value="",L.errorDiv.classList.remove("active")}),L.element.addEventListener("positive-pressed",function(e){if(0===L.input.value.trim().length)L.errorDiv.classList.add("active"),e.preventDefault();else{n.focus();var t=n.getSelection();n.setSelection(null);var i=L.input.value.trim();i.match(/^.+:\/\//)||(i="//"+i),t.end-t.start===0?n.insertText(t.start,L.input.value,"link",i):n.formatText(t.start,t.end,"link",i)}}),L.element.addEventListener("hide",function(e){L.positiveButton.blur()}),I.element.addEventListener("show",function(e){I.linkInput.disabled=!1,I.linkInput.value="",I.fileInput.disabled=!1,I.fileInput.value=null,I.positiveButton.classList.remove("uploading"),I.positiveButton.disabled=!1,I.errorDiv.classList.remove("active")}),I.linkInput.addEventListener("input",function(e){I.fileInput.disabled=!0}),I.fileInput.addEventListener("change",function(e){I.linkInput.disabled=!0}),I.element.addEventListener("positive-pressed",function(e){if(!I.linkInput.disabled&&I.linkInput.value.length>0){n.focus();var t=n.getSelection();n.insertEmbed(t.end,"image",I.linkInput.value)}else if(!I.fileInput.disabled&&I.fileInput.value.length>0){e.preventDefault(),I.uploadRequest=new XMLHttpRequest;var i=new FormData;i.append("image",I.fileInput.files[0]),I.uploadRequest.open("POST","/upload_image"),I.uploadRequest.onload=function(){var e=JSON.parse(I.uploadRequest.responseText);if(0===e.error){n.focus();var t=n.getSelection();n.insertEmbed(t.end,"image",e.url),I.modal.hide()}else 2===e.error&&(I.errorDiv.textContent="Image must be a JPG, PNG, or GIF.",I.errorDiv.classList.add("active"),I.positiveButton.classList.remove("uploading"),I.positiveButton.disabled=!1);I.uploadRequest=null},I.uploadRequest.send(i),I.positiveButton.classList.add("uploading"),I.positiveButton.disabled=!0}}),I.element.addEventListener("hide",function(e){I.positiveButton.blur(),null!=I.uploadRequest&&I.uploadRequest.abort()}),h.element.addEventListener("show",function(e){n.setSelection(null),h.selectLanguage.selectedIndex="0",i.setValue(""),i.focus()}),h.selectLanguage.addEventListener("change",function(e){i.getSession().setMode("ace/mode/"+h.selectLanguage.value)}),h.element.addEventListener("positive-pressed",function(e){n.focus();var t=n.getSelection();n.setSelection(null);for(var l=i.getValue().split("\n"),d=0;d<l.length;d++)0===l[d].length&&(l[d]="  ");l=l.join("\n"),n.insertText(t.end,l,"code",h.selectLanguage.value)}),h.element.addEventListener("hide",function(e){h.positiveButton.blur(),i.getSession().setMode("ace/mode/plain_text")}),o.addEventListener("focus",function(e){var t=document.getElementById("tag-input-div");t.classList.add("focused")}),o.addEventListener("blur",function(e){var t=document.getElementById("tag-input-div");t.classList.remove("focused")}),u.addEventListener("submit",function(e){l.value=n.getHTML(),canLoadInsignia()?a.value=s.value():a.value=o.value})});