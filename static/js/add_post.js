document.addEventListener("DOMContentLoaded",function(e){var t=document.getElementById("editor"),n=new Quill(t),i=ace.edit("code-editor"),l=document.getElementById("post-body"),d=document.getElementById("post-validity"),o=document.getElementById("tags-input"),a=document.getElementById("placeholder-tags-input"),s=insignia(o),u=document.getElementById("post-form"),r=document.getElementById("add-link"),c=document.getElementById("add-image"),m=document.getElementById("add-quote"),v=document.getElementById("add-code"),g=document.getElementById("align-left"),p=document.getElementById("align-center"),f=document.getElementById("align-right"),E=document.getElementById("align-justify"),h={element:document.getElementById("link-modal"),input:document.getElementById("modal-link"),init:function(){return this.modal=new Modal(this.element),this.errorDiv=this.element.querySelector("div.modal-error"),this.positiveButton=this.element.querySelector("button.positive"),delete this.init,this}}.init(),L={element:document.getElementById("image-modal"),linkInput:document.getElementById("image-url"),fileInput:document.getElementById("image-upload"),uploadRequest:null,init:function(){return this.modal=new Modal(this.element),this.positiveButton=this.element.querySelector("button.positive"),this.errorDiv=this.element.querySelector("div.modal-error"),delete this.init,this}}.init(),I={element:document.getElementById("code-modal"),selectLanguage:document.getElementById("select-language"),init:function(){return this.modal=new Modal(this.element,{keyboard:!1}),this.positiveButton=this.element.querySelector("button.positive"),delete this.init,this}}.init();n.addModule("toolbar",{container:"div#toolbar"}),n.addFormat("quote",{"class":"quote"}),n.addFormat("code",{"class":"language-"}),i.getSession().setUseWorker(!1),n.on("selection-change",function(e){null==e?(t.classList.remove("focused"),m.disabled=!0,v.disabled=!1):(t.classList.add("focused"),e.end-e.start>0?(m.disabled=!1,v.disabled=!0):(m.disabled=!0,v.disabled=!1))}),n.on("text-change",function(){var e=n.getSelection();null==e||e.end-e.start===0?(m.disabled=!0,v.disabled=!1):(m.disabled=!1,v.disabled=!0)}),r.addEventListener("click",function(e){h.modal.show(),h.input.focus()}),c.addEventListener("click",function(e){L.modal.show()}),v.addEventListener("click",function(e){I.modal.show()}),g.addEventListener("click",function(e){n.focus();var t=n.getSelection();null!=t&&n.formatLine(t.start,t.end,"align","left")}),p.addEventListener("click",function(e){n.focus();var t=n.getSelection();null!=t&&n.formatLine(t.start,t.end,"align","center")}),f.addEventListener("click",function(e){n.focus();var t=n.getSelection();null!=t&&n.formatLine(t.start,t.end,"align","right")}),E.addEventListener("click",function(e){n.focus();var t=n.getSelection();null!=t&&n.formatText(t.start,t.end+1,"align","justify")}),h.element.addEventListener("show",function(e){h.input.value="",h.errorDiv.classList.remove("active")}),h.element.addEventListener("positive-pressed",function(e){if(0===h.input.value.trim().length)h.errorDiv.classList.add("active"),e.preventDefault();else{n.focus();var t=n.getSelection();n.setSelection(null);var i=h.input.value.trim();i.match(/^.+:\/\//)||(i="//"+i),t.end-t.start===0?n.insertText(t.start,h.input.value,"link",i):n.formatText(t.start,t.end,"link",i)}}),h.element.addEventListener("hide",function(e){h.positiveButton.blur()}),L.element.addEventListener("show",function(e){L.linkInput.disabled=!1,L.linkInput.value="",L.fileInput.disabled=!1,L.fileInput.value=null,L.positiveButton.classList.remove("uploading"),L.positiveButton.disabled=!1,L.errorDiv.classList.remove("active")}),L.linkInput.addEventListener("input",function(e){L.fileInput.disabled=!0}),L.fileInput.addEventListener("change",function(e){L.linkInput.disabled=!0}),L.element.addEventListener("positive-pressed",function(e){if(!L.linkInput.disabled&&L.linkInput.value.length>0){n.focus();var t=n.getSelection();n.insertEmbed(t.end,"image",L.linkInput.value)}else if(!L.fileInput.disabled&&L.fileInput.value.length>0){e.preventDefault(),L.uploadRequest=new XMLHttpRequest;var i=new FormData;i.append("image",L.fileInput.files[0]),L.uploadRequest.open("POST","/upload_image"),L.uploadRequest.onload=function(){var e=JSON.parse(L.uploadRequest.responseText);if(0===e.error){n.focus();var t=n.getSelection();n.insertEmbed(t.end,"image",e.url),L.modal.hide()}else 2===e.error&&(L.errorDiv.textContent="Image must be a JPG, PNG, or GIF.",L.errorDiv.classList.add("active"),L.positiveButton.classList.remove("uploading"),L.positiveButton.disabled=!1);L.uploadRequest=null},L.uploadRequest.send(i),L.positiveButton.classList.add("uploading"),L.positiveButton.disabled=!0}}),L.element.addEventListener("hide",function(e){L.positiveButton.blur(),null!=L.uploadRequest&&L.uploadRequest.abort()}),I.element.addEventListener("show",function(e){n.setSelection(null),I.selectLanguage.selectedIndex="0",i.setValue(""),i.focus()}),I.selectLanguage.addEventListener("change",function(e){i.getSession().setMode("ace/mode/"+I.selectLanguage.value)}),I.element.addEventListener("positive-pressed",function(e){n.focus();var t=n.getSelection();n.setSelection(null);for(var l=i.getValue().split("\n"),d=0;d<l.length;d++)0===l[d].length&&(l[d]="  ");l=l.join("\n"),n.insertText(t.end,l,"code",I.selectLanguage.value)}),I.element.addEventListener("hide",function(e){I.positiveButton.blur(),i.getSession().setMode("ace/mode/plain_text")}),o.addEventListener("focus",function(e){var t=document.getElementById("tag-input-div");t.classList.add("focused")}),o.addEventListener("blur",function(e){var t=document.getElementById("tag-input-div");t.classList.remove("focused")}),u.addEventListener("submit",function(e){0===n.getText().trim().length?(d.setCustomValidity("Please fill out a post body."),e.preventDefault()):(l.value=n.getHTML(),a.value=s.value())})});