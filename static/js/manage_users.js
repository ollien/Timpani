function addInfoButtonListener(e){e.addEventListener("click",function(e){userInfoModal.show();var t=this.parentNode.getAttribute("user_id"),n=new XMLHttpRequest;n.open("GET","/get_user_info/"+t),n.addEventListener("load",function(e){var t=JSON.parse(n.responseText);0===t.error?(usernameDisplay.textContent=t.info.username,fullNameDisplay.textContent=t.info.full_name,0===t.info.permissions.length?(noPermissions.style.display="",permissionDisplayList.style.display="none"):(noPermissions.style.display="none",permissionDisplayList.style.display="",canChangeSettingsDisplay.style.display=t.info.permissions.indexOf("can_write_posts")>-1?"":"none",canWritePostsDisplay.style.display=t.info.permissions.indexOf("can_change_settings")>-1?"":"none")):1===t.error&&(window.location="/login")}),n.send()})}var PASSWORDS_DO_NOT_MATCH="Passwords do not match.";document.addEventListener("DOMContentLoaded",function(e){var t=document.getElementById("add-user-modal"),n=document.getElementById("user-info-modal"),s=new Modal(t);s.positiveButton=s.element.querySelector("button.positive");var i=new Modal(n);i.positiveButton=s.element.querySelector("button.positive");var o=document.getElementById("add-user-button"),a=document.getElementById("users-list"),d=document.getElementById("create-user-form"),r=d.querySelector("button"),l=document.querySelectorAll(".user-info-button"),u=document.getElementById("username-input"),c=document.getElementById("full-name-input"),m=document.getElementById("password-input"),p=document.getElementById("confirm-password-input"),y=document.getElementById("can-change-settings-checkbox"),f=document.getElementById("can-write-posts-checkbox");document.getElementById("username-display"),document.getElementById("full-name-display"),document.getElementById("permission-info"),document.getElementById("can-change-settings"),document.getElementById("can-write-posts"),document.getElementById("no-permissions");o.addEventListener("click",function(e){s.show()}),d.addEventListener("submit",function(e){s.positiveButton.classList.add("working"),e.preventDefault(),d.checkValidity();var t=new FormData;t.append(u.getAttribute("name"),u.value),t.append(c.getAttribute("name"),c.value),t.append(m.getAttribute("name"),m.value),y.checked&&t.append(y.getAttribute("name"),"on"),f.checked&&t.append(f.getAttribute("name"),"on");var n=new XMLHttpRequest;n.open("POST","/create_user"),n.addEventListener("load",function(e){var t=JSON.parse(n.responseText);if(s.positiveButton.classList.remove("working"),0===t.error){var i=t.user_id,o=document.createElement("li");o.setAttribute("user_id",i),o.classList.add("user");var d=document.createElement("span");d.classList.add("username"),d.textContent=u.value,o.appendChild(d);var c=document.createElement("span");c.classList.add("user-info-button"),c.classList.add("fa"),c.classList.add("fa-info-circle"),console.log(l),l.push(c),addInfoButtonListener(c),o.appendChild(c),o.style.opacity=0,a.appendChild(o);window.getComputedStyle(o).opacity;o.style.opacity=1,s.hide()}else 1===t.error?window.location="/login":2===t.error&&(u.setCustomValidity("Username already in use!"),r.click())}),n.send(t)}),u.addEventListener("input",function(e){this.setCustomValidity("")}),m.addEventListener("input",function(e){this.setCustomValidity(""),this.value!==p.value&&this.setCustomValidity(PASSWORDS_DO_NOT_MATCH)}),p.addEventListener("input",function(e){m.setCustomValidity(""),m.value!==this.value&&m.setCustomValidity(PASSWORDS_DO_NOT_MATCH)}),s.element.addEventListener("positive-pressed",function(e){e.preventDefault(),r.click()}),s.element.addEventListener("hide",function(e){d.reset(),m.setCustomValidity(""),p.setCustomValidity(""),u.setCustomValidity("")}),Array.prototype.slice.call(l).forEach(addInfoButtonListener)});