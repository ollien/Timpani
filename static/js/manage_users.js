var PASSWORDS_DO_NOT_MATCH="Passwords do not match.";document.addEventListener("DOMContentLoaded",function(e){function t(e){e.addEventListener("click",function(e){o.show();var t=this.parentNode.getAttribute("user_id"),n=new XMLHttpRequest;n.open("GET","/get_user_info/"+t),n.addEventListener("load",function(e){var t=JSON.parse(n.responseText);0===t.error?(f.textContent=t.info.username,E.textContent=t.info.full_name,0===t.info.permissions.length?(L.style.display="",h.style.display="none"):(L.style.display="none",h.style.display="",w.style.display=t.info.permissions.indexOf("can_write_posts")>-1?"":"none",B.style.display=t.info.permissions.indexOf("can_change_settings")>-1?"":"none")):1===t.error&&(window.location="/login")}),n.send()})}var n=document.getElementById("add-user-modal"),s=document.getElementById("user-info-modal"),i=new Modal(n);i.positiveButton=i.element.querySelector("button.positive");var o=new Modal(s);o.positiveButton=i.element.querySelector("button.positive");var d=document.getElementById("add-user-button"),a=document.getElementById("users-list"),l=document.getElementById("create-user-form"),r=l.querySelector("button"),u=Array.prototype.slice.call(document.querySelectorAll(".user-info-button")),c=document.getElementById("username-input"),m=document.getElementById("full-name-input"),p=document.getElementById("password-input"),y=document.getElementById("confirm-password-input"),v=document.getElementById("can-change-settings-checkbox"),g=document.getElementById("can-write-posts-checkbox"),f=document.getElementById("username-display"),E=document.getElementById("full-name-display"),h=document.getElementById("permission-info"),w=document.getElementById("can-change-settings"),B=document.getElementById("can-write-posts"),L=document.getElementById("no-permissions");d.addEventListener("click",function(e){i.show()}),l.addEventListener("submit",function(e){i.positiveButton.classList.add("working"),e.preventDefault(),l.checkValidity();var n=new FormData;n.append(c.getAttribute("name"),c.value),n.append(m.getAttribute("name"),m.value),n.append(p.getAttribute("name"),p.value),v.checked&&n.append(v.getAttribute("name"),"on"),g.checked&&n.append(g.getAttribute("name"),"on");var s=new XMLHttpRequest;s.open("POST","/create_user"),s.addEventListener("load",function(e){var n=JSON.parse(s.responseText);if(i.positiveButton.classList.remove("working"),0===n.error){var o=n.user_id,d=document.createElement("li");d.setAttribute("user_id",o),d.classList.add("user");var l=document.createElement("span");l.classList.add("username"),l.textContent=c.value,d.appendChild(l);var m=document.createElement("span");m.classList.add("user-info-button"),m.classList.add("fa"),m.classList.add("fa-info-circle"),console.log(u),u.push(m),t(m),d.appendChild(m),d.style.opacity=0,a.appendChild(d);window.getComputedStyle(d).opacity;d.style.opacity=1,i.hide()}else 1===n.error?window.location="/login":2===n.error&&(c.setCustomValidity("Username already in use!"),r.click())}),s.send(n)}),c.addEventListener("input",function(e){this.setCustomValidity("")}),p.addEventListener("input",function(e){this.setCustomValidity(""),this.value!==y.value&&this.setCustomValidity(PASSWORDS_DO_NOT_MATCH)}),y.addEventListener("input",function(e){p.setCustomValidity(""),p.value!==this.value&&p.setCustomValidity(PASSWORDS_DO_NOT_MATCH)}),i.element.addEventListener("positive-pressed",function(e){e.preventDefault(),r.click()}),i.element.addEventListener("hide",function(e){l.reset(),p.setCustomValidity(""),y.setCustomValidity(""),c.setCustomValidity("")}),u.forEach(t)});