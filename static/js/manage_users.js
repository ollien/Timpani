var PASSWORDS_DO_NOT_MATCH="Passwords do not match.";document.addEventListener("DOMContentLoaded",function(e){function t(e){e.addEventListener("click",function(e){d.show(),I=this.parentNode.getAttribute("user_id");var t=new XMLHttpRequest;t.open("GET","/get_user_info/"+I),t.addEventListener("load",function(e){var n=JSON.parse(t.responseText);0===n.error?(h.textContent=n.info.username,L.textContent=n.info.full_name,0===n.info.permissions.length?(_.style.display="",B.style.display="none"):(_.style.display="none",B.style.display="",C.style.display=n.info.permissions.indexOf("can_write_posts")>-1?"":"none",S.style.display=n.info.permissions.indexOf("can_change_settings")>-1?"":"none")):1===n.error&&(window.location="/login")}),t.send()})}var n=document.getElementById("add-user-modal"),s=document.getElementById("user-info-modal"),i=document.getElementById("change-password-modal"),o=new Modal(n);o.positiveButton=o.element.querySelector("button.positive");var d=new Modal(s);d.positiveButton=o.element.querySelector("button.positive");var a=new Modal(i);a.positiveButton=a.element.querySelector("button.positive");var r=document.getElementById("add-user-button"),u=document.getElementById("users-list"),l=document.getElementById("create-user-form"),c=l.querySelector("button"),m=Array.prototype.slice.call(document.querySelectorAll(".user-info-button")),p=document.getElementById("change-password-button"),y=document.getElementById("username-input"),v=document.getElementById("full-name-input"),g=document.getElementById("password-input"),f=document.getElementById("confirm-password-input"),E=document.getElementById("can-change-settings-checkbox"),w=document.getElementById("can-write-posts-checkbox"),h=document.getElementById("username-display"),L=document.getElementById("full-name-display"),B=document.getElementById("permission-info"),C=document.getElementById("can-change-settings"),S=document.getElementById("can-write-posts"),_=document.getElementById("no-permissions"),I=-1,O=document.getElementById("reset-password-input"),b=document.getElementById("confirm-password-reset-input"),A=document.getElementById("change-password-form"),D=A.querySelector("button");r.addEventListener("click",function(e){o.show()}),l.addEventListener("submit",function(e){o.positiveButton.classList.add("working"),e.preventDefault(),l.checkValidity();var n=new FormData;n.append(y.getAttribute("name"),y.value),n.append(v.getAttribute("name"),v.value),n.append(g.getAttribute("name"),g.value),E.checked&&n.append(E.getAttribute("name"),"on"),w.checked&&n.append(w.getAttribute("name"),"on");var s=new XMLHttpRequest;s.open("POST","/create_user"),s.addEventListener("load",function(e){var n=JSON.parse(s.responseText);if(o.positiveButton.classList.remove("working"),0===n.error){var i=n.user_id,d=document.createElement("li");d.setAttribute("user_id",i),d.classList.add("user");var a=document.createElement("span");a.classList.add("username"),a.textContent=y.value,d.appendChild(a);var r=document.createElement("span");r.classList.add("user-info-button"),r.classList.add("fa"),r.classList.add("fa-info-circle"),m.push(r),t(r),d.appendChild(r),d.style.opacity=0,u.appendChild(d);window.getComputedStyle(d).opacity;d.style.opacity=1,o.hide()}else 1===n.error?window.location="/login":2===n.error&&(y.setCustomValidity("Username already in use!"),c.click())}),s.send(n)}),y.addEventListener("input",function(e){this.setCustomValidity("")}),g.addEventListener("input",function(e){this.setCustomValidity(""),this.value!==f.value&&this.setCustomValidity(PASSWORDS_DO_NOT_MATCH)}),f.addEventListener("input",function(e){g.setCustomValidity(""),g.value!==this.value&&g.setCustomValidity(PASSWORDS_DO_NOT_MATCH)}),o.element.addEventListener("positive-pressed",function(e){e.preventDefault(),c.click()}),o.element.addEventListener("hide",function(e){l.reset(),g.setCustomValidity(""),f.setCustomValidity(""),y.setCustomValidity("")}),m.forEach(t),p.addEventListener("click",function(e){a.show()}),A.addEventListener("submit",function(e){a.positiveButton.classList.add("working"),e.preventDefault(),l.checkValidity();var t=new FormData;t.append("userId",I),t.append(O.getAttribute("name"),O.value);var n=new XMLHttpRequest;n.open("POST","/reset_password",!0),n.addEventListener("load",function(e){a.positiveButton.classList.add("working");var t=JSON.parse(n.responseText);0===t.error?a.hide():window.location="/login"}),n.send(t)}),O.addEventListener("input",function(e){O.setCustomValidity(""),this.value!==b.value&&O.setCustomValidity(PASSWORDS_DO_NOT_MATCH)}),b.addEventListener("input",function(e){O.setCustomValidity(""),this.value!==O.value&&O.setCustomValidity(PASSWORDS_DO_NOT_MATCH)}),a.element.addEventListener("positive-pressed",function(e){e.preventDefault(),D.click()}),a.element.addEventListener("hide",function(e){A.reset(),O.setCustomValidity("")})});