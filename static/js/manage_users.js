var PASSWORDS_DO_NOT_MATCH="Passwords do not match.";document.addEventListener("DOMContentLoaded",function(e){function t(e){e.addEventListener("click",function(e){a.show(),O=this.parentNode.getAttribute("user_id");var t=new XMLHttpRequest;t.open("GET","/get_user_info/"+O),t.addEventListener("load",function(e){var n=JSON.parse(t.responseText);0===n.error?(L.textContent=n.info.username,C.textContent=n.info.full_name,0===n.info.permissions.length?(I.style.display="",B.style.display="none"):(I.style.display="none",B.style.display="",S.style.display=n.info.permissions.indexOf("can_write_posts")>-1?"":"none",_.style.display=n.info.permissions.indexOf("can_change_settings")>-1?"":"none")):1===n.error&&(window.location="/login")}),t.send()})}function n(e){userElements=l.querySelectorAll("li.user");for(var t=0;t<userElements.length;t++)if(userElements[t].querySelector("span.username").textContent.toLowerCase()>e.toLowerCase())return userElements[t];return null}var s=document.getElementById("add-user-modal"),i=document.getElementById("user-info-modal"),o=document.getElementById("change-password-modal"),d=new Modal(s);d.positiveButton=d.element.querySelector("button.positive");var a=new Modal(i);a.positiveButton=d.element.querySelector("button.positive");var r=new Modal(o);r.positiveButton=r.element.querySelector("button.positive");var u=document.getElementById("add-user-button"),l=document.getElementById("users-list"),c=document.getElementById("create-user-form"),m=c.querySelector("button"),p=Array.prototype.slice.call(document.querySelectorAll(".user-info-button")),y=document.getElementById("change-password-button"),v=document.getElementById("username-input"),g=document.getElementById("full-name-input"),f=document.getElementById("password-input"),E=document.getElementById("confirm-password-input"),h=document.getElementById("can-change-settings-checkbox"),w=document.getElementById("can-write-posts-checkbox"),L=document.getElementById("username-display"),C=document.getElementById("full-name-display"),B=document.getElementById("permission-info"),S=document.getElementById("can-change-settings"),_=document.getElementById("can-write-posts"),I=document.getElementById("no-permissions"),O=-1,b=document.getElementById("reset-password-input"),A=document.getElementById("confirm-password-reset-input"),D=document.getElementById("change-password-form"),k=D.querySelector("button");u.addEventListener("click",function(e){d.show()}),c.addEventListener("submit",function(e){d.positiveButton.classList.add("working"),e.preventDefault(),c.checkValidity();var s=new FormData;s.append(v.getAttribute("name"),v.value),s.append(g.getAttribute("name"),g.value),s.append(f.getAttribute("name"),f.value),h.checked&&s.append(h.getAttribute("name"),"on"),w.checked&&s.append(w.getAttribute("name"),"on");var i=new XMLHttpRequest;i.open("POST","/create_user"),i.addEventListener("load",function(e){var s=JSON.parse(i.responseText);if(d.positiveButton.classList.remove("working"),0===s.error){var o=s.user_id,a=document.createElement("li");a.setAttribute("user_id",o),a.classList.add("user");var r=document.createElement("span");r.classList.add("username"),r.textContent=v.value,a.appendChild(r);var u=document.createElement("span");u.classList.add("user-info-button"),u.classList.add("fa"),u.classList.add("fa-info-circle"),p.push(u),t(u),a.appendChild(u),a.style.opacity=0,a.style.height="0px";var c=n(v.value);null===c?l.appendChild(a):l.insertBefore(a,c),window.getComputedStyle(a).opacity,window.getComputedStyle(a).height,a.style.opacity=1,a.style.height="",d.hide()}else 1===s.error?window.location="/login":2===s.error&&(v.setCustomValidity("Username already in use!"),m.click())}),i.send(s)}),v.addEventListener("input",function(e){this.setCustomValidity("")}),f.addEventListener("input",function(e){this.setCustomValidity(""),this.value!==E.value&&this.setCustomValidity(PASSWORDS_DO_NOT_MATCH)}),E.addEventListener("input",function(e){f.setCustomValidity(""),f.value!==this.value&&f.setCustomValidity(PASSWORDS_DO_NOT_MATCH)}),d.element.addEventListener("positive-pressed",function(e){e.preventDefault(),m.click()}),d.element.addEventListener("hide",function(e){c.reset(),f.setCustomValidity(""),E.setCustomValidity(""),v.setCustomValidity("")}),p.forEach(t),y.addEventListener("click",function(e){r.show()}),D.addEventListener("submit",function(e){r.positiveButton.classList.add("working"),e.preventDefault(),c.checkValidity();var t=new FormData;t.append("userId",O),t.append(b.getAttribute("name"),b.value);var n=new XMLHttpRequest;n.open("POST","/reset_password",!0),n.addEventListener("load",function(e){r.positiveButton.classList.add("working");var t=JSON.parse(n.responseText);0===t.error?r.hide():window.location="/login"}),n.send(t)}),b.addEventListener("input",function(e){b.setCustomValidity(""),this.value!==A.value&&b.setCustomValidity(PASSWORDS_DO_NOT_MATCH)}),A.addEventListener("input",function(e){b.setCustomValidity(""),this.value!==b.value&&b.setCustomValidity(PASSWORDS_DO_NOT_MATCH)}),r.element.addEventListener("positive-pressed",function(e){e.preventDefault(),k.click()}),r.element.addEventListener("hide",function(e){D.reset(),b.setCustomValidity("")})});